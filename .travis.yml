language: node_js
env:
  global:
    # - secure: ""
    # - secure: ""
    - secure: "Tye6/rssYfBQp+euo7fnSs7S+/hmCkBT1u0CWzW5R0mHRRpZf5MQRonqHwXrypFtHoZuLlqmJC7woy5T+yuyNZoGNL5r19kSlOWCcFDvDCZD/qghq9DoKN+u9AAoIu7phSNa0ve86NZM91hvad8evkRoIaHM2umjkx8fSmMRjkY="
    # - DEPLOY_PATH=
node_js:
  - 8
before_script:
  - npm install grunt-cli -g
script:
  - grunt
after_success:
  - echo "Grunt Success"
# Zip directory on repo master
# Create tag with version in latest commit
before_deploy:
  - zip -r ods-widgets.zip dist/
  - git tag "$(git log -n 1 --pretty=oneline origin/master | sed -n -e 's/^.*Release //p')"
# Push new version in master with tag release
deploy:
  provider: releases
  api_key:
    secure: $API_KEY_GITHUB
  file: ods-widgets.zip
  skip_cleanup: true
  on:
    branch: feature/13169_refactor_ods-widgets_build_system
# Push new version on server prod
after_deploy:
  - echo "New release"
  # - 'test $TRAVIS_PULL_REQUEST == "false" && test $TRAVIS_BRANCH == "feature/13169_refactor_ods-widgets_build_system" && echo "Commit / Grunt - DONE"'